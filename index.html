<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>plan lekcji</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">

    <script type="text/javascript" src="//code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="//ciasteczka.eu/cookiesEU-latest.min.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function(){
      	jQuery.fn.cookiesEU();
      });
    </script>

    <script>
      function setCookie(name,value,days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days*24*60*60*1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "")  + expires + "; path=/";
      }
      function getCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
      }
    </script>

    <script type="text/javascript">
      function httpGet(theUrl)
      {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "GET", "https://cors.bridged.cc/" + theUrl, false );
        xmlHttp.send( null );
        return [xmlHttp.responseText, xmlHttp.getResponseHeader("x-final-url")];
      }

      function start() {
        var classId = getCookie("classId");

        var baseUrl = httpGet("http://www.batory.edu.pl/plan/index.php")[1];
        baseUrl = baseUrl.split("/").splice(2, 3);
        baseUrl.splice(0, 0, "http:/");

        if (classId == null || classId == "") {
          listUrl = baseUrl;
          listUrl.push("lista.html");
          listUrl = listUrl.join("/");

          var classList = httpGet(listUrl)[0].split("href=\"plany/o");
          classList.splice(0, 1);

          var chooseClassDiv = document.getElementById("chooseClass");
          var a;
          for (var i = 0; i < classList.length; i++) {
            classList[i] = classList[i].split("</")[0].split("\" target=\"plan\">");
            classList[i][0] = "o" + classList[i][0];

            a = document.createElement("a");
            a.innerText = classList[i][1];
            a.id = classList[i][0]
            a.onclick = function() {
              setCookie("classId", this.id, 310);
              chooseClassDiv.style.display = "none";
              start();
            };
            chooseClassDiv.appendChild(a);
            chooseClassDiv.appendChild(document.createElement("br"));
          }
          chooseClassDiv.style.display = "block";
        }
        else {
          var src = baseUrl.join("/") + "/plany/" + classId;
          console.log(src);

          document.getElementById("frame").src = src;
          document.getElementById("frame").style.display = "block";
          document.getElementById("wrap").style.pointerEvents = "all";
          document.getElementById("resetClass").style.display = "block";
        }

        // document.getElementById('frame').src = listUrl;
        // document.getElementById("frame").style.display = "block";
      }
    </script>

    <style>
      h1 {
        font-size: 3.5vw;
      }
      a {
        font-size: 2vw;
        color: #0000EE;
      }
      p {
        font-size: 2vw;
      }
      footer {
        position: fixed;
        width: 100%;
        bottom: 1vh;
      }

      #wrap { width: 125vw; height: 90vh; position: fixed; left: -25vw; top: -3vh; overflow: hidden; overflow-y: scroll; display: block; pointer-events: none; }
      #frame {
          padding: 0;
          width: 100vw;
          height: 90vh;
          transform: scale(1.5);
          transform-origin: 0 0;
      }
    </style>
  </head>
  <body onload=start() style="font-family: 'Roboto', sans-serif; margin: 0;">
    <div id="wrap">
      <iframe id="frame" src="" style="display: none; top:0; left:0; bottom:0; right:0; border:none; margin:0; padding:0; overflow:hidden;"></iframe>
    </div>
    <div id="chooseClass" style="display: none; margin: auto; margin-left: auto; margin-right: auto; text-align: center;">
      <h1>Choose your class</h1>
    </div>
    <div id="resetClass" style="display: none; position: sticky;">
      <a onclick="document.cookie = 'classId=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';" href="">Change class</a>
    </div>

    <footer>
        <p style="text-align: center;">Â© 2021 bewu <a href="https://github.com/bewu-ib/planlekcji-batory">github repo</a></p>
    </footer>
  </body>
</html>
