---
layout: default
---

<p>Google Calendar API Quickstart</p>

<button id="authorize_button" style="display: none;">Authorize</button>
<p id="signed_in_email" style="display: none;">Signed in as email@gmail.com</p>
<button id="signout_button" style="display: none;">Sign Out</button>

<pre id="content" style="white-space: pre-wrap;"></pre>

<script src="/js/gcalendar.js"></script>

<!-- gapi onload -->
<script async defer src="https://apis.google.com/js/api.js"
  onload="this.onload=function(){};handleClientLoad()"
  onreadystatechange="if (this.readyState === 'complete') this.onload()">
</script>

<!-- addRecurringEvent("3Nowy test",
"2022-02-16T11:00:00.00Z", "2022-02-16T21:00:00.00Z", "20220318", "5"); -->
<button type="button" name="button" id="addEventsBtn">Add events</button>
<script type="text/javascript">
  $("#addEventsBtn").click(function fun() {
    l = JSON.parse(localStorage.getItem("calendarPlan"));
    plan = l[0];
    hours = l[1];

    console.log(plan);

    // test lessons
    // addLessonEvent("test", 2, "8:00-8:45", "s69", "bw");
    // addLessonEvent("2test", 6, "9:00-9:45", "s29", "wb");

    events_to_add = [];

    // for day in plan
    for (var i = 0; i < plan.length; i++) {
      // for lesson in day
      for (var j = 0; j < Object.entries(plan[i]).length; j++) {
        console.log("DAY", i, "LESSON", j);

        key = Object.entries(plan[i])[j][0];
        value = Object.entries(plan[i])[j][1];

        hour = hours[key];

        // if two (multiple) lessons at one time
        if (Array.isArray(value[0])) {
          for (var k = 0; k < value.length; k++) {

            // if j is not last
            if (j < Object.entries(plan[i]).length-1) {
              keyNext = Object.entries(plan[i])[j+1][0];
              valueNext = Object.entries(plan[i])[j+1][1];

              // two same lessons next to each other
              if (Array.isArray(valueNext[0]) && k < valueNext.length && value[k][0] == valueNext[k][0]) {
                hour = hour.split("-");
                hour[1] = hours[keyNext].split("-")[1];
                hour = hour.join("-");

                // skip next lesson
                j += 1;
              }
            }

            console.log(i, hour, value[k]);
            events_to_add.push([value[k][0], i, hour, value[k][1], value[k][2]]);
          }
        }
        else {  // one lesson at a time

          // if j is not last
          if (j < Object.entries(plan[i]).length-1) {
            keyNext = Object.entries(plan[i])[j+1][0];
            valueNext = Object.entries(plan[i])[j+1][1];

            // two same lessons next to each other
            if (value[0] == valueNext[0]) {
              hour = hour.split("-");
              hour[1] = hours[keyNext].split("-")[1];
              hour = hour.join("-");

              // skip next lesson
              j += 1;
            }
          }

          console.log([value[0], i, hour, value[1], value[2]]);
          events_to_add.push([value[0], i, hour, value[1], value[2]]);
        }
      }
    }

    console.log(events_to_add);

    // add events with timeout
    e_i = 0;
    const addEventsLoop = setInterval(function fun() {
      value = events_to_add[e_i];

      console.log(`${e_i+1}/${events_to_add.length}`);
      console.log(value);

      addLessonEvent(value[0], value[1], value[2], value[3], value[4],
        [e_i+1, events_to_add.length]);

      e_i += 1;
      if (e_i >= events_to_add.length) {
        clearInterval(addEventsLoop);
      }
    }, 200);
  })
</script>
