---
layout: default
---

<p>Google Calendar API Quickstart</p>

<button id="authorize_button" style="display: none;">Authorize</button>
<p id="signed_in_email" style="display: none;">Signed in as email@gmail.com</p>
<button id="signout_button" style="display: none;">Sign Out</button>

<pre id="content" style="white-space: pre-wrap;"></pre>

<script src="/js/gcalendar.js"></script>

<!-- gapi onload -->
<script async defer src="https://apis.google.com/js/api.js"
  onload="this.onload=function(){};handleClientLoad()"
  onreadystatechange="if (this.readyState === 'complete') this.onload()">
</script>

<!-- addRecurringEvent("3Nowy test",
"2022-02-16T11:00:00.00Z", "2022-02-16T21:00:00.00Z", "20220318", "5"); -->
<button type="button" name="button" id="addEventsBtn">Add events</button>
<script type="text/javascript">
  $("#addEventsBtn").click(function fun() {
    l = JSON.parse(localStorage.getItem("calendarPlan"));
    plan = l[0];
    hours = l[1];

    console.log(plan);

    // test lessons
    // addLessonEvent("test", 2, "8:00-8:45", "s69", "bw");
    // addLessonEvent("2test", 6, "9:00-9:45", "s29", "wb");

    // for day in plan
    for (var i = 0; i < plan.length; i++) {
      // for lesson in day
      lessonLoop(i, 0);

      function lessonLoop(a, b) {
        console.log("DAY", a, "LESSON", b);

        key = Object.entries(plan[a])[b][0];
        value = Object.entries(plan[a])[b][1];

        hour = hours[key];

        // if b is not last
        if (b < Object.entries(plan[a]).length-1) {

          keyNext = Object.entries(plan[a])[b+1][0];
          valueNext = Object.entries(plan[a])[b+1][1];

          // two same lessons next to each other
          if (value[0] == valueNext[0]) {
            console.log("BLOK");

            hour = hour.split("-");
            hour[1] = hours[keyNext].split("-")[1];
            hour = hour.join("-");

            // skip next lesson
            b += 1;
          }
        }

        console.log(a, hour, value);

        addLessonEvent(value[0], a, hour, value[1], value[2]);

        if (b < Object.entries(plan[a]).length-1) {
          setTimeout(function fun() {
            lessonLoop(a, b+1);
          }, 500);  // Rate limit requests
        }
        else {
          b = 0;
        }
      }
    }

    // localStorage.removeItem("calendarPlan");
    // window.location = "/plan.html";
  })
</script>
